## 微处理器基本功能及主要性能指标

### 微处理器的基本功能

微处理器是微型计算机的核心部件，也称中央处理单元，就是**CPU**（Central Processing Unit）。它负责微型计算机中各部件的协调，完成指令的执行和数据处理工作。

其主要功能包括：

- **指令控制**：指令执行顺序

- **操作控制**：各部件功能协调

- **时间控制**：各信号时序

- **数据加工**：算术/逻辑运算

### 微处理器的基本结构

**控制器** **CU**（Control Unit）：计算机的指挥控制中心，负责按照一定顺序自动读取程序中的指令，将指令译码后产生相应控制信号，控制各部件协同工作。

**运算器** **ALU**（Arithmetic Logic Unit）：计算机的核心功能部件，主要负责算术、逻辑运算等数据加工功能。

**寄存器组** **RS**（Register Set）：是 CPU 中暂存数据和指令的逻辑部件，用于临时存放数据或地址。

> 除此以外，微处理器常常还包括一定的高速缓存部件。

### 微处理器的主要性能指标

**工作频率**：包括主频、外频、倍频。主频是微处理器的工作频率，反映微处理器工作节奏的快慢；外频是指系统总线的工作频率，它反映外部设备的工作速度；倍频是指微处理器工作频率对系统总线工作频率的倍数。

> 三者之间的关系可以表示为：**主频 = 外频 × 倍频**

**处理器字长**：反映微处理器单次数据处理能力，字长越长表示单次处理数据能力越强。

**前端总线速度**：前端总线指主板芯片组中的北桥芯片与 CPU 之间传输数据的通道，因此也称为 CPU 的外部总线。 它反映 CPU 与内存和显示部件之间交换数据的能力，前端总线速度越快，CPU 与外界交换信息的能力越好，有利于提高整体处理速度。

**地址总线宽度**：描述微处理器可以访问物理存储空间的重要指标。微处理器通过地址总线表达其访问数据所在的地址，地址总线越多则表示该微处理器可以给出的物理地址数越多，可以连接的物理内存就越大。

**数据总线宽度**：描述微处理器与外界交换数据能力的一个重要指标。微处理器每一根数据线表示一个比特数据，数据线越多则表示每一次与外界交换的数据位数就越多，相对交换速度就越快。

**高速缓冲容量和级数**：高速缓存（Cache）是设置在微处理器内部的一种存储器。由于其存取速度要比内存高一个数量级，可以达到与微处理器部件同频的工作速度，因此利用高速缓存可以提高处理器的工作效率。Cache 根据速度和位置不同可分两级或三级。

**生产工艺**：不同的生产工艺对 CPU 的功耗和工作频率有较大影响，生产工艺越先进 CPU 功耗越低，工作频率越高。

**其它性能指标**：包括特殊指令扩展、超线程、流水线、乱序执行、动态执行，以及新一代 CPU 的双核、多核技术等体系结构方面的技术。而且体系结构对现代微处理器性能的影响已经超过制造工艺对计算机性能的影响，成为现代微处理器设计的重要技术指标。

<br>

## Intel 8086 微处理器 ⭐😱

### Intel 8086 的功能结构 ⭐

- 16 位处理器、40 脚的 DIP（双列直插）封装。
- 时钟频率：5、8 和 10MHz。
- 20 条地址线，有 2^20=1024KB=1MB 寻址能力。

#### Intel 8086 的内部组成结构

![](https://cdn.jsdelivr.net/gh/hassanblog/CDN@v20210405/posts/Microcomputer_Note/image-20210314201708363.png)

| Intel 8086 的内部组成结构                  | 组成                                                                                                                                              | 功能                                                                                                                                                                         |
| ------------------------------------------ | ------------------------------------------------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **总线接口部件 BIU**（Bus Interface Unit） | 1. **段寄存器** Segment Register（CS、DS、ES、SS）<br>2. **指令指针** Instruction pointer（IP）<br>3. **地址加法器、总线控制**<br>4. **指令队列** | 1. 外部总线连接，完成 EU 所需的总线操作，计算形成 20 位的物理地址。<br/>2. 从内存储器中取出指令送指令队列排队。<br/>3. 按 EU 的要求读写内存、I/O 中的操作数。                |
| **执行部件 EU**（Execution Unit）          | 1. **通用寄存器**<br/>2. **标志寄存器**<br/>3. **ALU**<br/>4. **EU 控制**                                                                         | 1. 从指令队列获得指令，译码、执行指令操作。<br/>2. 译码指令、执行算术运算、逻辑运算。<br/>3. 向 BIU 提供操作数的内存或 I／O 端口的地址。<br/>4. 管理标志寄存器和指令操作数。 |

#### Intel 8086 内部寄存器

##### 8 个通用寄存器：

- 8086 的 16 位通用寄存器是：

  AX、BX、CX、DX

  SI、DI、BP、SP

  其中前 4 个数据寄存器都还可以分成高 8 位和低 8 位两个独立的寄存器

- 8086 的 8 位通用寄存器是：

  AH、BH、CH、DH

  AL、BL、CL、DL

  对其中某 8 位的操作，并不影响另外对应 8 位的数据

##### 4 个段寄存器

DS 数据段寄存器 (Data Segment)

CS 代码段寄存器 (Code Segment)

ES 附加段寄存器 (Extra Segment)

SS 堆栈段寄存器 (Stack Segment)

这些段寄存器的内容与有效的地址一起，用于确定内存的物理地址。通常用 CS、DS、ES 以及 SS 用于确定数据段、代码段、附加段以及堆栈段的**基地址**。

##### 1 个指令指针寄存器

- 指令指针寄存器**IP**，指示代码段中指令的**偏移地址**

- 它与**代码段寄存器 CS**联用，确定**下一条指令的物理地址**

- 计算机通过 **CS : IP** 寄存器来**控制指令序列的执行流程**

- IP 寄存器是一个专用寄存器

##### 1 个标志寄存器

- 标志（Flag）用于反映**指令执行结果**或**控制指令执行形式**
- 8086 处理器的各种标志形成了一个 16 位的标志寄存器 FLAGS（程序状态字 PSW 寄存器）

<img src="https://cdn.jsdelivr.net/gh/hassanblog/CDN@v20210405/posts/Microcomputer_Note/image-20210323171354067.png" alt="8086 微处理器内部寄存器" style="zoom: 67%;" />

!> 熟记并能背下来（老师要求）

###### 标志的分类

- **状态标志**：用来记录程序运行结果的状态信息，许多指令的执行都将相应地设置它

  CF、ZF、SF、PF、OF、AF

- **控制标志**：可由程序根据需要用指令设置，用于控制处理器执行指令的方式

  DF、IF、TF

| 状态标志                                        | 含义                                                                                                                                                          | 判断                                                                      |
| ----------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------- |
| **进位标志 CF**<br/>（Carry Flag）              | 当运算结果的最高有效位有进位（加法）或借位（减法）时，进位标志置 1，即 CF = 1；否则 CF = 0。                                                                  | 49H+6DH=B6H（无进位：CF=0）<br>BBH+6AH=（1）25H（有进位：CF=1）           |
| **零标志 ZF**<br/>（Zero Flag）                 | 若运算结果为 0，则 ZF = 1；否则 ZF = 0；                                                                                                                      | 49H+6DH=B6H（结果不是零：ZF=0）<br>75H+8BH=（1）00H（结果是零：ZF=1）     |
| **符号标志 SF**<br/>（Sign Flag）               | 运算结果最高位为 1，则 SF = 1；否则 SF = 0                                                                                                                    | 3AH+7CH=B6H（最高位 D7=1：SF=1）<br>84H+7CH=（1）00H（最高位 D7=0：SF=0） |
| 奇偶标志 PF<br/>（Parity Flag）                 | 当运算结果最低字节中“1”的个数为零或偶数时，PF = 1；否则 PF = 0                                                                                                | 3AH+7CH=B6H=10110110B<br>结果中有 5 个 1，是奇数：PF=0                    |
| 溢出标志 OF<br/>（Overflow Flag）               | 若算术运算的结果有溢出，则 OF=1；否则 OF=0。CPU 对 OF 的计算：最高位进位 ⊕ 次高位进位<br>程序员的判断方法：**正正相加得负或负负相加得正有溢出，其余均无溢出** | 49H+6DH=B6H（产生溢出：OF = 1）<br>75H+8BH=（1）26H（没有溢出：OF = 0）   |
| **辅助进位标志 AF**<br>（Auxiliary Carry Flag） | 运算时 D3 位（低半字节）有进位或借位时，AF = 1；否则 AF = 0。                                                                                                 | 49H+6DH=B6H，D3 有进位：AF = 1                                            |
| 方向标志 DF<br>（Direction Flag）               | 用于串操作指令中，控制地址的变化方向                                                                                                                          | 设置 DF=0，存储器地址自动增加；<br>设置 DF=1，存储器地址自动减少。        |
| 中断允许标志 IF<br>（Interrupt-enable Flag）    | 用于控制外部可屏蔽中断是否可以被处理器响应                                                                                                                    | 设置 IF ＝ 1，则允许中断；<br>设置 IF ＝ 0，则禁止中断。                  |
| 陷阱标志 TF （跟踪标志）<br>（Trap Flag）       | 用于控制处理器进入单步操作方式                                                                                                                                | 设置 TF=0，处理器正常工作；<br>设置 TF=1，处理器单步执行指令。            |

> 溢出和进位：
>
> - **进位标志**表示**无符号数**运算结果是否超出范围，运算结果仍然**正确**；
> - **溢出标志**表示**有符号数**运算结果是否超出范围，运算结果已经**不正确**（毕竟正正得负怎么可能对）；

### Intel 8086 的存储器组织及其寻址 😱

#### 主存储器的分段机构

**段地址**：也叫段基址，用 16 位二进制数表示。

**偏移地址**：也叫有效地址，段内地址的顺序编号，用 16 位二进制数表示。

**段地址**：**段内偏移地址** 的表示方法称**逻辑地址**。

如，2000H:100H

**物理地址和逻辑地址的转换**：

物理地址(PA) = 段地址 × 16 + 偏移地址(EA)

> - 相当于是段地址右边加个 0，再加上偏移地址
>
> - 一个物理地址可以有多个逻辑地址

**物理地址和逻辑地址的使用场合**：

**物理地址**：CPU 访问内存时使用

**逻辑地址**：程序员描述内存单元的地址时使用

### Intel 8086 的引脚功能 😱

8086CPU 的 40 条引脚信号可按功能分可分为四类，它们是：

- 地址总线

- 数据总线

- 控制总线

- 其它（时钟与电源）

#### 指令周期、总线周期和时钟周期

- **指令周期**（Instruction Cycle）：执行一条指令所需要的时间称为指令周期，不同指令的指令周期不等长。

- **总线周期**（Bus Cycle）：CPU 与外部交换信息总是通过总线进行的，CPU 的每一个这种信息输入、输出过程需要的时间称为总线周期，每当 CPU 要从存储器或输入输出端口存取一个字节或字就需要一个总线周期。一个指令周期由一个或若干个总线周期组成。

  例如：

  ADD AL, [100H]

  ADD [100H], AL

- **时钟周期**（Clock Cycle）：时钟脉冲的重复周期称为时钟周期，由计算机的主频决定。

- 8086CPU 的总线周期至少由 4 个时钟周期组成，分别以 T1、T2、T3、T4 表示（T 代表 State）。

- 一个总线周期完成一次数据传输，在 T1 期间由 CPU 输出地址，在 T2、T3、T4 期间传输数据。

#### 最小模式和最大模式概念

**最小模式**：在系统中只有一个微处理器。

**最大模式**：两个或多个微处理器（主处理器、协处理器 8087、8089）

#### 最小模式下引脚功能

<img src="https://cdn.jsdelivr.net/gh/hassanblog/CDN@v20210405/posts/Microcomputer_Note/image-20210315154053255.png" alt="8086 CPU的引脚图" style="zoom:67%;" />

1. AD~15~～ AD~0~，地址/数据复用引脚

   数据总线：双向、三态信号

   地址总线：输出、三态信号。

2. A~19~/S~6~ ～ A~16~/S~3~ ，地址/状态总线复用，输出，三态

   T1：输出 20 位地址信息的高 4 位

   其它 T 周期：输出状态信息。

3. $\overline{\text{RD}}$，读信号，输出，三态

4. $\overline{\text{WR}}$，写信号，输出，三态

5. M/$\overline{\text{IO}}$，存储器/输入输出操作选择控制信号，输出，三态

- **高电平**：CPU 和存储器进行数据传输。
- **低电平**：CPU 和 I/O 设备进行数据传输。

6. $\overline{\text{BHE}}$/S~7~，高 8 位数据总线允许/状态复用信号，输出，三态

- T1：

  $\overline{\text{BHE}}$/S~7~=0，高 8 位数据有效。

  $\overline{\text{BHE}}$/S~7~=1，仅在数据总线 AD~7~～ AD~0~上传送 8 位数据。

- 其它 T 周期：输出状态信号 S~7~，在 8086 中没有实际定义。

7. ALE，地址锁存允许信号，输出

   实现地址信息与数据信息的分时复用。

8. DT/$\overline{\text{R}}$，数据发送/接收控制信号，三态，输出

9. $\overline{\text{DEN}}$，数据允许信号，输出，三态

   与总线收发器联络

10. $\overline{\text{INTR}}$，可屏蔽中断请求信号，输入

11. $\overline{\text{NMI}}$，非屏蔽中断请求信号，输入

12. $\overline{\text{INTA}}$，中断响应信号，输出，三态

13. READY，准备就绪，输入信号

    当被访问的部件无法在**8086CPU**规定的时间内完成数据传送时与**CPU**进行联络的信号。

14. $\overline{\text{TEST}}$，测试输入信号

    在**WAIT**（等待）指令期间，**8086CPU**每隔 5 个时钟周期对$\overline{\text{TEST}}$引脚进行采样：

    若$\overline{\text{TEST}}$为高电平，则**CPU**循环于等待状态。

    若$\overline{\text{TEST}}$为低电平，则**CPU**脱离等待状态，继续执行后续指令。

15. RESET，复位输入信号

    复位信号高电平至少应保持**4**个时钟周期，随着**RESET**变为低电平，CPU 就开始执行再启动过程。**CPU**复位之后，从**FFFF0H**单元开始读取指令字节。

16. HOLD，总线保持请求信号，输入

17. HLDA，总线保持响应信号，输出

    其它设备要获得系统总线的控制权与 CPU 的一对联络信号。

18. CLK，时钟输入端

为微处理器提供基本的定时脉冲

19. VCC，电源输入

要求接上正电压（+5V±10%）

20. GND，地线

<br>

## Intel 8086 微处理器基本时序

省略，看课本

<br>

<br>
