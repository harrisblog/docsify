## 汇编语言程序设计概述

### 程序设计语言

1. **机器语言**：用二进制表示，能够被机器直接识别

2. **汇编语言**：采用**助记符**表示机器指令

3. **高级语言**：接近自然语言

### 汇编语言源程序

通常以**.asm**作为文件扩展名。汇编语言程序设计中由于开发环境支持不同，可以有**完整段程序**和简化段程序。

### 汇编语言程序开发过程

基本步骤是：**编辑**(xxx.asm)👉**汇编**(xxx.obj)👉**连接**(xxx.exe)👉 调试运行

## 汇编语言基本语法 ⭐

### 汇编语言的语句类型

1. **指令性语句**：由指令构成，与机器指令一一对应。

   `[标号:] 操作码 操作数 [;注释]`

   如: `START: MOV AX ,DATA ;初始化数据段`

2. **指示性语句**：由命令（伪指令）构成，是程序员发给汇编程序的命令，没有相应的机器指令。

   `[名字] 伪指令 [操作数] [;注释]`

   如: `DATA SEGMENT`

### 二、常量、标识符和表达式

#### 常量

指令中出现的固定值，在程序运行期间不会变化。分为**数字常量**、**字符常量**和**符号常量**三种。(指令中的立即数，MEM 直接地址)

##### 数字常量

直接用数字表示的常量。

二进制：10000100B、11110001020100B

十进制：12356D

十六进制：12ABH、0F56AH（<u>字母开头必须前面补 0，否则将出现汇编语法错误</u>）

> 例如：
>
> MOV AX，100D
>
> MOV BL，0FAH

##### 字符串常量

包含在<u>单引号</u>内的<u>一个或两个</u>ASCII 字符构成，它所代表的数值就是该字符的 ASCII 码。

例如字符'A'等价于 41H，字符'AB'等价于 4142H。

> 例如：
>
> MOV AL, <u>'A'</u>
>
> MOV AX, <u>'AB'</u>

##### 符号常量

用标识符（常量名）表示的常量，它具有一个设定的数值从而被引用。

#### 标识符

有特定意义的字符序列，标识符可用作符号常量、名字、变量和标号等。

标识符**命名规则**和 C 语言类似，不过多赘述。

#### 表达式

由操作数（常量、变量、标号）和运算符构成。

在汇编时完成相应的运算(数字常数)，（OBJ）目标程序中不存在表达式，应用程序的 DEBUG 调试中不可能看到任何表达式。

<img src="https://unpkg.zhimg.com/hassan-assets/posts/Microcomputer_Note/image-20210406170238311.png" style="zoom: 80%;" />

例如：

**AND** AL, 86H <u>AND</u> 0FH

**AND**是指令；

<u>AND</u>是逻辑运算符，86H AND 0FH=06H

汇编后的指令是：AND AL, 06H

> **注意：**
>
> - 逻辑运算符只能对常数（或相当于常数）进行运算。
>
> - 与逻辑运算指令不同, CPU 不执行任何操作，汇编时运算，在目标程序中只是一个常数。

### 三、汇编语言程序伪指令 ⭐

#### 程序结束伪指令

**格式**：END 标号

**说明**：标号为程序中第一条指令性语句标号

#### 段定义伪指令

8086 分段访问存储器。

##### 段定义语句

**格式**：

```assembly
段名 SEGMENT [定位方式][组合方式]['类别名']
...
段名 ENDS
```

**例如**：

```assembly
DATA SEGMENT
...
DATA ENDS
CODE SEGMENT
...
CODE ENDS
```

定义了二个段，段名分别为 DATA、CODE。

**说明**：定义数据段、附加数据段和堆栈段时，处于 SEGMENT/ENDS 伪指令中间的语句，只能包括伪指令语句，不能包括指令语句。

#### 段寄存器说明伪指令

**格式**：ASSUME 段寄存器：段名 1，段寄存器：段名 2……

**说明**：在代码段，告诉汇编程序 CS、DS、ES、SS 应具有的符号段基址，但是段寄存器（CS 除外）还必须用传送指令赋值。一般紧跟在 SEGMENT 语句之后。

#### 过程定义的伪指令

**格式**：

```assembly
过程名 PROC NEAR[FAR]
...
过程名 ENDP
```

**说明**：

NEAR 近过程（主、子同段）

FAR 远过程（主、子在两个不同的代码段）

#### 数据定义伪指令

数据定义语句用来为数据分配存储单元，数据段、附加段和堆栈段都是存放数据的，其中所用的语句主要是数据定义语句。

**格式**：[变量名] 命令 参数 1，参数 2，… [；注释]

> **说明**：
>
> **变量名**是由程序员在编程时按标识符规定取的。

命令：表示符号及功能如下：

**DB** 字节 （8 位）一个字节存贮单元

**DW** 字 （16 位）二个连续字节存贮单元

~~DD 双字 （32 位）四个连续字节存贮单元~~

~~DQ 双字 （64 位）8 个连续字节存贮单元~~

~~DT 双字 （80 位）10 个连续字节存贮单元~~

**参数**：相应内存单元中的数据，可以是数字常量、字符常量或符号常量，当它是保留时就以问号（?）表示。参数可以有多个，相互间用逗号（,）隔开，若连续多个数据是重复的，可用复制符 DUP 以简化书写，DUP 的用法为：

`<复制次数> DUP（<数据>）`

> 例如： ARRAY DB 10 DUP(12H)
>
> 意为 12H 复制 10 次

> 提示：字符'A'是 41H，'B'是 42H，以此类推

![](https://unpkg.zhimg.com/hassan-assets/posts/Microcomputer_Note/image-20210528144528207.png)

![](https://unpkg.zhimg.com/hassan-assets/posts/Microcomputer_Note/image-20210528144706770.png)

!> 注意：除用 DB 定义的字符串常量外，单引号中 ASCII 字符的个数<u>不得超过 2 个</u>，若只有 1 个，如 DW ‘C'，就相当于 DW 0043H。DB 定义的字符串常量 ASCII 字符数量不限制。

#### 符号定义伪指令

##### 应用命令 EQU 和 PURGE

**格式**：符号常量 EQU 表达式

**说明**：如需对已赋值的名字<u>赋以新值</u>，则先用 PURGE 语句撤销原赋值。

其格式为：`PURGE 名字`

> PURGE 可同时撤销几个已赋值。

**例如**：

```assembly
COUNT	EQU  20
ADD		AX,COUNT
PURGE	COUNT
COUNT	EQU  30
ADD		AX,COUNT
```

##### 应用命令"="

**格式**： 符号常量=表达式

**说明**：其功能与 EQU 类似，唯一的区别是命令"="可<u>随时对名字赋新值</u>，而不必使用 PURGE 命令。

**例如**：

```assembly
COUNT = 20
ADD	AX,COUNT
COUNT = 30
ADD	AX,COUNT
```

#### 变量

##### "$"的含义

```assembly
DATA SEGMENT
ARRAY DB 10H,5AH,0C7H,98H,'ABCD'
COUNT EQU $-ARRAY
MAX DB 12H
DATA ENDS
```

> 说明：$表示该行的偏移地址，此处 COUNT 表示 ARRAY 有多少个元素。

##### 变量的五种属性

###### 段基址

**格式**：SEG 符号名

**例如**：MOV AX,SEG AA

**说明**：SEG AA 为立即寻址，是 AA 的**段地址**

###### 偏移地址

**格式**：OFFSET 符号名

**例如**：MOV SI,OFFSET BB

**说明**：OFFSET BB 为立即寻址,是 BB 的**偏移地址**

###### 符号名的类型值

格式：TYPE 符号名

###### 长度属性

格式：LENGTH 符号名

###### 规模属性

格式： SIZE 符号名

##### 类型指定运算符 PTR

**格式**：类型 PTR 表达式

**说明**：类型可以是**BYTE、WORD**、DWORD、NEAR、FAR

**作用**：按 PTR 前面指定的类型去寻址

**例如**： INC BYTE PTR [2000H]

### 四、DOS 系统功能调用 ⭐

Q：什么叫 DOS 系统功能调用？

A：为提高汇编程序的编程效率，减少重复开发过程，MS-DOS 操作系统内置了几十个子程序，这些子程序能够完成大量底层功能，用户程序可以通过软中断的方式使用这些子程序，<u>软中断号为 21H</u>。 指令为 <u>INT 21H</u>。

DOS 系统功能子程序使用的基本要求如下：

1. 传送入口参数到指定寄存器中；

2. 调用子功能的功能编号放在<u>AH 寄存器</u>中；

3. <u>执行 INT 21H 指令</u>。

#### 键盘单字符输入（1 号）

MOV AH，1

INT 21H

**功能**：等待从键盘输入一个字符。

**返回**：（AL）=ASCII 码，并回显在显示器上

#### 输出单字符（2 号）

MOV DL，'A'

MOV AH，2

INT 21H

**功能**：将 DL 中字符从屏幕上输出。

**返回**：无返回

#### 输出字符串（09 号）

MOV DX，OFFSET BUF ↔ LEA DX, BUF

MOV AH，09

INT 21H

**功能**：BUF 中以`$`为结束标志的字符串显示在屏幕上。当无结束标志时会出现乱码。

#### 键盘输入字符串（0AH 号）

MOV DX，OFFSET BUF

MOV AH，0AH

INT 21H

**功能**：等待从键盘输入一串字符，回车结束。字符串存入键盘缓冲区。

键盘缓冲区定义：

BUF DB 81 ;**缓冲区**的大小

DB ? ;**实际**输入的字符个数

DB 80 DUP（?） ;**字符串**存放区

#### 返回操作系统（4CH）

MOV AH，4CH

INT 21H

**功能**： 将控制权交给操作系统，写在程序末尾。

> 这 5 个功能学完够用。
>
> **速记**：入出出入返回，前俩单字符，后俩字符串；1、2、09H、0AH、4CH

## 汇编语言程序设计 ⭐😱

程序设计的一般步骤：

1. 分析问题

2. 确定算法

3. 分配存贮区

4. 绘制流程图

5. 根据流程图编程

6. 调试程序

### 子程序的调用

**格式**：CALL 过程名（子程序地址）

**功能**：

1. 下条指令的地址压入堆栈。

   主子同段（段内调用）：

   只将 IP 的值压入堆栈

   段间调用：

   先将 CS 的值压入堆栈，再将 IP 的值压入堆栈。

2. 转入子程序运行 （子程序的地址送入 CS：IP）

### 子程序的返回

**格式**：RET

**说明**：子程序的最后一条指令，用于返回 CALL 指令的下条指令继续执行。无论对那一种调用方式其返回指令都相同。

**功能**：

1. 段内调用只将当前[SP]弹进 IP，从而使程序正常返回。

2. 对于段间调用则先弹 IP，再弹 CS。

**子程序的设计与应用应注意的问题**

1. 现场的保护

   ```assembly
   PUSH	AX
   PUSH	BX
   PUSH 	SI
   ...
   ...
   POP		SI
   POP		BX
   POP		AX
   RET
   ```

2. 参数的传递

   主程序调用子程序必须传递入口参数，

   子程序返回必须传递出口参数。

   **常用的方法有**：

   - **寄存器**：适用于参数少的情况。

   - **约定单元**：适用于参数多的情况。要事先建立参数数据缓冲区。

   - **堆栈**：适用于参数较多，且子程序嵌套，递归调用的情况。
